<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>Immaginary</title>
	</head>
	<body>
		<script src="https://koda.nu/simple.js">

			class Complex {
				constructor(re, im, t=0, index=0) {
					this.re = re;
					this.im = im;

					this.t = t;
					this.x = 0;
					this.y = 0;
					this.c = "rgba(0,0,0,1)";
					this.index = index;
				}

				draw() {
					save();
					translate(totalWidth/2, totalHeight/2);
					this.x = (this.re*xScl+this.t*tScl*cos(angle));
					this.y = -(this.im*yScl-this.t*tScl*sin(angle));
					this.c = "rgba(170," + Math.abs(this.im*30) + "," + Math.abs(this.re*30) + ",0.45)";

					if(this.index != 0) {
						let lastPoint = points[this.index-1];
						let thisPoint = points[this.index];
						if(lastPoint != null && thisPoint != null) {
							line(lastPoint.x, lastPoint.y, points[this.index].x, points[this.index].y, 3, this.c);
						}
					}

					circle(this.x, this.y, 8, this.c);
					restore();
				}
			}

			updatesPerSecond = 2020;
			//const angle = 3*pi/4;

			let xScl = 10;
			let yScl = 10;
			let tScl = 10;

			let startT = 1000;
			let t = startT;
			let points = [];

			function drawAxis() {
				let c = "rgba(0,0,0,0.5)"
				text(50, 50, 15, "Re-Scale: " + xScl, c);
				text(50, 65, 15, "Im-Scale: " + yScl, c);
				text(50, 80, 15, "T-Scale: " + tScl, c);

				line(0, totalHeight/2, totalWidth, totalHeight/2, 1, c);
				line(totalWidth/2, 0, totalWidth/2, totalHeight, 1, c);
				save();
				translate(totalWidth/2, totalHeight/2);
				rotateRadians(angle);
				line(0, 0, totalWidth, 0, 1, c);
				line(-totalWidth, 0, 0, 0, 1, c);
				line(0, 0, totalWidth, 0, 1, c);
				restore();
			}

			function rescale() {
				if(keyboard.r) {
					xScl = 10;
					yScl = 10;
					tScl = 10;
					redraw = true;
				}

				if(keyboard.shift) {
					if(keyboard.up || keyboard.w) {
						xScl++;
						yScl++;
						redraw = true;
					}

					if(keyboard.down || keyboard.s) {
						xScl--;
						yScl--;
						redraw = true;
					}
				} else {
					if(keyboard.right) {
						xScl--;
						redraw = true;
					}

					if(keyboard.left) {
						xScl++;
						redraw = true;
					}

					if(keyboard.up) {
						yScl++;
						redraw = true;
					}

					if(keyboard.down) {
						yScl--;
						redraw = true;
					}

					if(keyboard.w) {
						tScl++;
						redraw = true;
					}

					if(keyboard.s) {
						tScl--;
						redraw = true;
					}
				}
			}

			var angle = pi/4;

			let lastAngle = angle;
			let index = 0;
			let redraw = false;

			function update() {

				redraw = false;

				rescale();

				angle = -Math.atan2(((totalHeight/2)-mouse.y),(mouse.x-(totalWidth/2)));

				if(angle != lastAngle || redraw) {
					clearScreen();
					drawAxis();
					for(let point of points) {
						point.draw();
					}
				}

				lastAngle = angle;

				if(t >= -startT) {
					t-=1.3;
					let dt = 0.07*t;

					let im = new Complex(sin(sin(dt))*10, 10*sin(10*cos(dt/4)), 0.002*t, index);
					points.push(im);
					index++;

					im.draw();

				}
			}

		</script>
	</body>
</html>
